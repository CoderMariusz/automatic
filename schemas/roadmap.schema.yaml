# Roadmap Schema
# Validates roadmap.yaml generated in Stage 3

$schema: http://json-schema.org/draft-07/schema#
type: object
required:
  - roadmap_version
  - generated_at
  - total_epics
  - total_stories
  - execution_strategy
  - priorities
  - dependency_graph
  - execution_batches

properties:
  roadmap_version:
    type: string
    pattern: '^\d+\.\d+$'

  generated_at:
    type: string
    format: date-time

  total_epics:
    type: integer
    minimum: 1
    maximum: 18

  total_stories:
    type: integer
    minimum: 1
    maximum: 500

  execution_strategy:
    type: string
    enum: [sequential, parallel, dependency-aware]

  priorities:
    type: object
    required:
      - NOW
      - NEXT
      - LATER
    properties:
      NOW:
        $ref: '#/definitions/priority_bucket'
      NEXT:
        $ref: '#/definitions/priority_bucket'
      LATER:
        $ref: '#/definitions/priority_bucket'

  dependency_graph:
    type: array
    minItems: 1
    description: Story-level dependency graph
    items:
      type: object
      required:
        - story_id
        - depends_on
        - execution_mode
      properties:
        story_id:
          type: string
          pattern: '^epic-\d{2}[a-z]?\.story-\d{2}$'

        depends_on:
          type: array
          items:
            type: string
            pattern: '^epic-\d{2}[a-z]?\.story-\d{2}$'

        execution_mode:
          type: string
          enum: [sequential, parallel]

  execution_batches:
    type: array
    minItems: 1
    description: Ordered batches for execution
    items:
      type: object
      required:
        - batch_id
        - execution_mode
        - stories
      properties:
        batch_id:
          type: string
          pattern: '^batch-\d{2}$'

        execution_mode:
          type: string
          enum: [sequential, parallel]

        stories:
          type: array
          minItems: 1
          items:
            type: string
            pattern: '^epic-\d{2}[a-z]?\.story-\d{2}$'

        estimated_duration:
          type: string
          description: Human-readable duration estimate

        depends_on:
          type: array
          items:
            type: string
            pattern: '^batch-\d{2}$'

  risks:
    type: array
    description: Story-level risk flags
    items:
      type: object
      required:
        - story_id
        - risk_level
        - description
        - mitigation
      properties:
        story_id:
          type: string
          pattern: '^epic-\d{2}[a-z]?\.story-\d{2}$'

        risk_level:
          type: string
          enum: [low, medium, high, critical]

        description:
          type: string
          minLength: 10
          maxLength: 500

        mitigation:
          type: string
          minLength: 10
          maxLength: 500

  critical_path:
    type: array
    description: Critical path stories (longest chain)
    items:
      type: string
      pattern: '^epic-\d{2}[a-z]?\.story-\d{2}$'

  critical_path_duration:
    type: string
    description: Estimated critical path duration

  recommendations:
    type: array
    description: Execution recommendations
    items:
      type: string
      minLength: 10
      maxLength: 300

definitions:
  priority_bucket:
    type: object
    required:
      - epics
      - stories
      - estimated_duration
      - rationale
    properties:
      epics:
        type: array
        items:
          type: string
          pattern: '^epic-\d{2}[a-z]?$'

      stories:
        type: integer
        minimum: 0

      estimated_duration:
        type: string
        description: Human-readable duration (e.g., "2 weeks")

      rationale:
        type: string
        minLength: 10
        maxLength: 500
