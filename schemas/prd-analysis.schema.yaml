# PRD Analysis Schema
# Validates output from prd-analyzer agent (Stage 0)

$schema: http://json-schema.org/draft-07/schema#
type: object
required:
  - analysis_version
  - analyzed_at
  - prd_metadata
  - recommended_epic_count
  - decomposition_strategy
  - proposed_epics

properties:
  analysis_version:
    type: string
    pattern: '^\d+\.\d+$'
    description: Schema version (e.g., "1.0")

  analyzed_at:
    type: string
    format: date-time
    description: ISO 8601 timestamp of analysis

  prd_metadata:
    type: object
    required:
      - total_requirements
      - complexity_score
    properties:
      total_requirements:
        type: integer
        minimum: 1
        description: Total number of requirements in PRD

      functional_requirements:
        type: integer
        minimum: 0
        description: Count of functional requirements

      non_functional_requirements:
        type: integer
        minimum: 0
        description: Count of non-functional requirements

      complexity_score:
        type: number
        minimum: 1
        maximum: 10
        description: Complexity rating (1=simple, 10=extremely complex)

  recommended_epic_count:
    type: integer
    minimum: 2
    maximum: 18
    description: Optimal number of epics for this PRD

  decomposition_strategy:
    type: string
    enum: [thematic, functional, hybrid]
    description: Strategy used for epic decomposition

  proposed_epics:
    type: array
    minItems: 2
    maxItems: 18
    description: Proposed epic breakdown
    items:
      type: object
      required:
        - epic_id
        - title
        - scope
        - estimated_ac
        - rationale
      properties:
        epic_id:
          type: string
          pattern: '^epic-\d{2}$'
          description: Epic identifier (e.g., "epic-01")

        title:
          type: string
          minLength: 5
          maxLength: 100
          description: Epic title

        scope:
          type: string
          minLength: 10
          maxLength: 500
          description: Brief scope description

        estimated_ac:
          type: integer
          minimum: 1
          maximum: 30
          description: Estimated acceptance criteria count

        rationale:
          type: string
          minLength: 10
          maxLength: 300
          description: Justification for epic boundaries

  quality_issues:
    type: array
    description: PRD quality concerns identified
    items:
      type: object
      required:
        - severity
        - issue
        - recommendation
      properties:
        severity:
          type: string
          enum: [low, medium, high, critical]

        issue:
          type: string
          minLength: 5
          maxLength: 200

        recommendation:
          type: string
          minLength: 5
          maxLength: 300
