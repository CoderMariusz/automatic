story_id: "12.prd-config-instruction"
epic: "prd-flow"
type: "backend"
priority: "P0"
complexity: "M"
status: "pending"

description: |
  Stworzenie instrukcji dla agenta Config (PRD-C-config.md).

  Agent konfiguruje:
  - Preferencje tech stack (Backend, Database, Frontend, UI Library)
  - Które research agents uruchomić (Tech, Competition, Docs, Financial)
  - Czy włączyć web search dla każdego research agenta
  - Technologie must-use lub must-avoid

  Agent bazuje na discovery.yaml i wyświetla podsumowanie projektu.

acceptance_criteria:
  - id: AC-1
    title: "Load and display discovery summary"
    given: "discovery.yaml exists"
    when: "Agent starts"
    then:
      - "Reads discovery.yaml"
      - "Displays: Projekt: {project.name}"
      - "Displays: Problem: {problem.statement (skrócone)}"
      - "Displays: MVP Features: {scope.mvp_features (lista)}"
      - "Says: 'Teraz skonfigurujemy badania dla tego projektu.'"

  - id: AC-2
    title: "Tech stack preferences - 4 questions"
    given: "Agent in config phase"
    when: "Agent asks tech preferences"
    then:
      - "Q1: BACKEND - jaka technologia? Options: Node.js, Python, Go, Nie mam preferencji"
      - "Q2: BAZA DANYCH - jaka? Options: Supabase, Firebase, PostgreSQL, MongoDB, Nie mam"
      - "Q3: FRONTEND - jaki framework? Options: Next.js, React (Vite), Vue.js, Nie mam"
      - "Q4: UI LIBRARY - jaka? Options: shadcn/ui, Chakra UI, Material UI, Własne, Nie mam"
      - "Accepts both numbers (1-5) and text answers"

  - id: AC-3
    title: "Research topics selection"
    given: "Tech preferences collected"
    when: "Agent asks about research"
    then:
      - "Shows checkboxes for 4 research types:"
      - "  1. Tech Research - Analiza technologii"
      - "  2. Competition Research - Analiza konkurencji"
      - "  3. Documentation Research - Dokumentacja technologii"
      - "  4. Financial Research - Analiza kosztów"
      - "Asks: 'Wpisz numery (np. 1,2,4 lub wszystkie lub żadne)'"
      - "Parses comma-separated numbers or keywords"

  - id: AC-4
    title: "Web search per research agent"
    given: "User selected research topics"
    when: "Agent asks about web search"
    then:
      - "For each ENABLED research topic:"
      - "  Asks: '{Research Name} - czy agent ma szukać w internecie?'"
      - "  Shows: TAK: aktywne wyszukiwanie (wolniejsze, dokładniejsze)"
      - "  Shows: NIE: bazuje na wiedzy (szybsze, może być nieaktualne)"
      - "  Accepts: TAK/NIE or yes/no or y/n"

  - id: AC-5
    title: "Constraints and special requirements"
    given: "Web search config collected"
    when: "Agent asks final questions"
    then:
      - "Q: 'Czy masz konkretnych konkurentów do przeanalizowania?'"
      - "   (Wpisz nazwy oddzielone przecinkami lub 'brak')"
      - "Q: 'Czy są technologie które MUSISZ użyć lub MUSISZ unikać?'"
      - "   (np. 'musi być TypeScript' lub 'bez PHP')"

  - id: AC-6
    title: "YAML output format"
    given: "All config collected"
    when: "Agent outputs research-config.yaml"
    then:
      - "Outputs valid YAML with structure:"
      - "  tech_preferences:"
      - "    backend.choice, database.choice, frontend.choice, ui_library.choice"
      - "    constraints.must_use[], constraints.must_avoid[]"
      - "  research_config:"
      - "    tech: {enabled: bool, web_search: bool, focus_areas: []}"
      - "    competition: {enabled: bool, web_search: bool, known_competitors: []}"
      - "    documentation: {enabled: bool, web_search: bool, technologies_to_research: []}"
      - "    financial: {enabled: bool, web_search: false}"
      - "Ends with: ===CONFIG_COMPLETE=== and ===NEXT_STEP_READY==="

  - id: AC-7
    title: "Flexible input parsing"
    given: "User provides answer"
    when: "Agent parses input"
    then:
      - "Accepts '1' or 'Node.js' for tech choices"
      - "Accepts 'wszystkie' or 'all' for research topics"
      - "Accepts 'żadne' or 'none' for research topics"
      - "Accepts 'TAK'/'tak'/'yes'/'y' for web search"
      - "Accepts 'NIE'/'nie'/'no'/'n' for web search"
      - "Accepts 'brak' or empty for optional fields"

technical_notes:
  - "Instruction file should be ~180 lines"
  - "Use numbered options for tech choices (easier for users)"
  - "Default web_search=false for financial research (no current pricing data needed)"
  - "technologies_to_research should be populated from tech_preferences choices"
  - "Reference plan section 4.5 for detailed spec"

files_to_create:
  - path: "instructions/prd/PRD-C-config.md"
    description: "Config agent instruction file (~180 lines)"

files_to_modify: []

example_output: |
  ```yaml
  # research-config.yaml - wygenerowane przez PRD-C
  # Data: 2026-01-21T13:00:00Z

  tech_preferences:
    backend:
      choice: "Node.js (Express/Fastify)"
      reason: ""
    database:
      choice: "Supabase (PostgreSQL + Auth)"
      reason: ""
    frontend:
      choice: "Next.js + React"
      reason: ""
    ui_library:
      choice: "shadcn/ui (Tailwind)"
      reason: ""
    constraints:
      must_use: ["TypeScript"]
      must_avoid: ["PHP"]

  research_config:
    tech:
      enabled: true
      web_search: true
      focus_areas:
        - "backend scalability"
        - "database performance"

    competition:
      enabled: true
      web_search: true
      known_competitors:
        - "Competitor1"
        - "Competitor2"

    documentation:
      enabled: true
      web_search: true
      technologies_to_research:
        - "Next.js"
        - "Supabase"
        - "shadcn/ui"

    financial:
      enabled: true
      web_search: false
      considerations:
        - "hosting costs"
        - "saas pricing"
  ```
