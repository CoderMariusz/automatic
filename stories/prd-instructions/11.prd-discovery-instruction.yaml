story_id: "11.prd-discovery-instruction"
epic: "prd-flow"
type: "backend"
priority: "P0"
complexity: "L"
status: "pending"

description: |
  Stworzenie instrukcji dla agenta Discovery (PRD-D-discovery.md).

  Agent przeprowadza strukturyzowaną rozmowę z użytkownikiem aby zebrać:
  - Nazwę i jednozdaniowy opis projektu
  - Problem który rozwiązuje
  - Użytkowników i ich frustracje
  - Cele biznesowe i metryki sukcesu
  - MVP features i scope
  - Ograniczenia (timeline, budżet, techniczne)

  KLUCZOWE: Agent zapisuje DOSŁOWNIE słowa użytkownika (nie parafrazuje).

acceptance_criteria:
  - id: AC-1
    title: "Conversation protocol - 5 phases"
    given: "Agent starts discovery"
    when: "Agent executes"
    then:
      - "Phase 1: Asks for project name and one-liner (1-2 questions)"
      - "Phase 2: Asks about users and frustrations (2-3 questions)"
      - "Phase 3: Asks about goals and success metrics (2-3 questions)"
      - "Phase 4: Asks about scope and features (2-3 questions)"
      - "Phase 5: Presents summary and asks for confirmation"
      - "Total: Max 12 questions"

  - id: AC-2
    title: "ONE question at a time rule"
    given: "Agent is in conversation"
    when: "Agent asks question"
    then:
      - "Asks exactly ONE question per message"
      - "Never combines multiple questions"
      - "Waits for user response before next question"

  - id: AC-3
    title: "Literal transcription (DOSŁOWNIE)"
    given: "User provides answer"
    when: "Agent records to discovery.yaml"
    then:
      - "Uses exact user's words without paraphrasing"
      - "Preserves user's language and phrasing"
      - "Marks values with {DOSŁOWNIE} in examples"

  - id: AC-4
    title: "Summary and confirmation"
    given: "All questions answered"
    when: "Agent presents summary"
    then:
      - "Shows structured summary of all answers"
      - "Asks: 'Czy to jest poprawne? Czy chcesz coś zmienić?'"
      - "If user confirms, proceeds to output"
      - "If user wants changes, asks follow-up questions"

  - id: AC-5
    title: "YAML output format"
    given: "User confirms summary"
    when: "Agent outputs discovery.yaml"
    then:
      - "Outputs valid YAML structure"
      - "Includes all required fields:"
      - "  - project.name, project.one_liner"
      - "  - problem.statement, problem.current_pain_points"
      - "  - users.primary.persona, users.primary.frustrations"
      - "  - goals.primary (array of goals)"
      - "  - success_metrics (array)"
      - "  - scope.mvp_features, scope.out_of_scope"
      - "  - constraints.timeline, constraints.budget, constraints.technical"
      - "  - confirmation.user_confirmed: true"
      - "  - confirmation.timestamp (ISO format)"
      - "Ends with: ===DISCOVERY_COMPLETE=== and ===NEXT_STEP_READY==="

  - id: AC-6
    title: "Anti-patterns documented"
    given: "Instruction file content"
    when: "Developer reads instruction"
    then:
      - "Section '## CZEGO NIE ROBIĆ' lists forbidden actions:"
      - "  - ❌ NIE zakładaj stack technologiczny"
      - "  - ❌ NIE sugeruj rozwiązań architektonicznych"
      - "  - ❌ NIE wymyślaj funkcji"
      - "  - ❌ NIE zadawaj wielu pytań naraz"
      - "  - ❌ NIE używaj żargonu bez wyjaśnienia"
      - "  - ❌ NIE kończ bez potwierdzenia"

  - id: AC-7
    title: "Example conversation included"
    given: "Instruction file content"
    when: "Developer reads instruction"
    then:
      - "Includes full example Q&A transcript"
      - "Shows proper question pacing (one at a time)"
      - "Shows confirmation step before output"
      - "Demonstrates literal transcription"

technical_notes:
  - "Instruction file should be ~250 lines of Markdown"
  - "Use clear headings: ## KONTEKST, ## PROTOKÓŁ ROZMOWY, ## ZASADY, ## OUTPUT FORMAT"
  - "Include YAML code block with complete discovery.yaml template"
  - "Show example with placeholders like {DOSŁOWNIE nazwa}"
  - "Reference plan: C:\\Users\\MaKrawczyk\\.claude\\plans\\majestic-questing-widget.md section 4.4"

files_to_create:
  - path: "instructions/prd/PRD-D-discovery.md"
    description: "Discovery agent instruction file (~250 lines)"

files_to_modify: []

example_output: |
  ```yaml
  # discovery.yaml - wygenerowane przez PRD-D
  # Data: 2026-01-21T12:45:00Z
  # Status: CONFIRMED

  project:
    name: "DriveSchool"
    one_liner: "Aplikacja do zarządzania szkołą jazdy"

  problem:
    statement: |
      Instruktorzy używają papierowych kalendarzy i WhatsApp do umawiania
      lekcji, tracą czas na administrację zamiast uczyć
    current_pain_points:
      - "Fragmentacja narzędzi - papier, WhatsApp, Excel"
      - "Trudność w śledzeniu postępu kursantów"

  users:
    primary:
      persona: "Instruktor jazdy, 35-50 lat, samozatrudniony"
      frustrations:
        - "Spędzam 2h dziennie na organizacji"

  goals:
    primary:
      - goal: "Zmniejszyć czas administracji o 50%"
      - goal: "Zwiększyć retencję kursantów o 20%"

  success_metrics:
    - metric: "Czas na administrację"
      target: "<30 min/dzień"

  scope:
    mvp_features:
      - "Kalendarz lekcji z widokiem tygodniowym"
      - "Zarządzanie kursantami (lista, postęp)"

  constraints:
    timeline: "MVP za 3 miesiące"
    budget: "Do 500 PLN/msc"

  confirmation:
    user_confirmed: true
    timestamp: "2026-01-21T12:45:00Z"
  ```
